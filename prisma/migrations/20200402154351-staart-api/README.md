# Migration `20200402154351-staart-api`

This migration has been generated by Anand Chowdhary at 4/2/2020, 3:43:51 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE `staart`.`access-tokens` ;

ALTER TABLE `staart`.`api-keys` ;

ALTER TABLE `staart`.`approved-locations` ;

ALTER TABLE `staart`.`backup-codes` DROP COLUMN `used`,
ADD COLUMN `used` boolean NOT NULL DEFAULT false ;

ALTER TABLE `staart`.`domains` DROP COLUMN `isVerified`,
ADD COLUMN `isVerified` boolean NOT NULL DEFAULT false ;

ALTER TABLE `staart`.`emails` DROP COLUMN `isVerified`,
ADD COLUMN `isVerified` boolean NOT NULL DEFAULT false ;

ALTER TABLE `staart`.`identities` ;

ALTER TABLE `staart`.`memberships` ;

ALTER TABLE `staart`.`organizations` DROP COLUMN `autoJoinDomain`,
ADD COLUMN `autoJoinDomain` boolean NOT NULL DEFAULT false ,
DROP COLUMN `forceTwoFactor`,
ADD COLUMN `forceTwoFactor` boolean NOT NULL DEFAULT false ,
DROP COLUMN `onlyAllowDomain`,
ADD COLUMN `onlyAllowDomain` boolean NOT NULL DEFAULT false ;

ALTER TABLE `staart`.`sessions` ;

ALTER TABLE `staart`.`users` DROP COLUMN `checkLocationOnLogin`,
ADD COLUMN `checkLocationOnLogin` boolean NOT NULL DEFAULT false ,
DROP COLUMN `prefersColorSchemeDark`,
ADD COLUMN `prefersColorSchemeDark` boolean NOT NULL DEFAULT false ,
DROP COLUMN `prefersReducedMotion`,
ADD COLUMN `prefersReducedMotion` boolean NOT NULL DEFAULT false ,
DROP COLUMN `twoFactorEnabled`,
ADD COLUMN `twoFactorEnabled` boolean NOT NULL DEFAULT false ;

ALTER TABLE `staart`.`webhooks` DROP COLUMN `isActive`,
ADD COLUMN `isActive` boolean NOT NULL DEFAULT false ;

ALTER TABLE `staart`.`access-tokens` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`api-keys` ADD FOREIGN KEY (`organizationId`) REFERENCES `staart`.`organizations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`approved-locations` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`backup-codes` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`domains` ADD FOREIGN KEY (`organizationId`) REFERENCES `staart`.`organizations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`emails` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`identities` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`memberships` ADD FOREIGN KEY (`organizationId`) REFERENCES `staart`.`organizations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`memberships` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`sessions` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`webhooks` ADD FOREIGN KEY (`organizationId`) REFERENCES `staart`.`organizations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200402154351-staart-api
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,176 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource mysql {
+  provider = "mysql"
+  url      = env("DATABASE_URL")
+}
+
+model access_tokens {
+  createdAt      DateTime
+  description    String?
+  expiresAt      DateTime
+  id             Int      @default(autoincrement()) @id
+  jwtAccessToken String
+  name           String?
+  scopes         String?
+  updatedAt      DateTime @default(dbgenerated())
+  user           users    @relation(fields: [userId], references: [id])
+  userId         Int
+
+  @@map("access-tokens")
+}
+
+model api_keys {
+  createdAt            DateTime
+  description          String?
+  expiresAt            DateTime
+  id                   Int           @default(autoincrement()) @id
+  ipRestrictions       String?
+  jwtApiKey            String
+  name                 String?
+  organization         organizations @relation(fields: [organizationId], references: [id])
+  organizationId       Int
+  referrerRestrictions String?
+  scopes               String?
+  updatedAt            DateTime      @default(dbgenerated())
+
+  @@map("api-keys")
+}
+
+model approved_locations {
+  createdAt DateTime?
+  id        Int       @default(autoincrement()) @id
+  subnet    String
+  user      users     @relation(fields: [userId], references: [id])
+  userId    Int
+
+  @@map("approved-locations")
+}
+
+model backup_codes {
+  code      Int      @id
+  createdAt DateTime
+  updatedAt DateTime @default(dbgenerated())
+  used      Boolean      @default(false)
+  user      users    @relation(fields: [userId], references: [id])
+  userId    Int
+
+  @@index([userId], name: "id")
+  @@map("backup-codes")
+}
+
+model domains {
+  createdAt        DateTime
+  domain           String
+  id               Int           @default(autoincrement()) @id
+  isVerified       Boolean       @default(false)
+  organizations    organizations @relation(fields: [organizationId], references: [id])
+  organizationId   Int
+  updatedAt        DateTime @default(dbgenerated())
+  verificationCode String
+}
+
+model emails {
+  createdAt  DateTime
+  email      String
+  id         Int      @default(autoincrement()) @id
+  isVerified Boolean  @default(false)
+  updatedAt  DateTime @default(dbgenerated())
+  user       users    @relation(fields: [userId], references: [id])
+  userId     Int
+
+  @@index([userId], name: "userId")
+}
+
+model identities {
+  createdAt  DateTime
+  id         Int      @default(autoincrement()) @id
+  identityId String
+  loginName  String
+  type       String
+  updatedAt  DateTime @default(dbgenerated())
+  user       users    @relation(fields: [userId], references: [id])
+  userId     Int
+}
+
+model memberships {
+  createdAt      DateTime
+  id             Int           @default(autoincrement()) @id
+  organization   organizations @relation(fields: [organizationId], references: [id])
+  organizationId Int
+  role           String        @default("member")
+  updatedAt      DateTime      @default(dbgenerated())
+  user           users         @relation(fields: [userId], references: [id])
+  userId         Int
+
+  @@index([organizationId], name: "org")
+  @@index([userId], name: "user")
+}
+
+model organizations {
+  autoJoinDomain   Boolean      @default(false)
+  createdAt        DateTime
+  forceTwoFactor   Boolean      @default(false)
+  id               Int      @default(autoincrement())
+  ipRestrictions   String?
+  name             String?
+  onlyAllowDomain  Boolean      @default(false)
+  profilePicture   String   @default("https://unavatar.now.sh/fallback.png")
+  stripeCustomerId String?
+  updatedAt        DateTime @default(dbgenerated())
+  username         String
+
+  @@id([id, username])
+}
+
+model sessions {
+  createdAt DateTime
+  id        Int      @default(autoincrement()) @id
+  ipAddress String
+  jwtToken  String
+  updatedAt DateTime @default(dbgenerated())
+  userAgent String
+  user      users    @relation(fields: [userId], references: [id])
+  userId    Int
+}
+
+model users {
+  checkLocationOnLogin   Boolean      @default(false)
+  countryCode            String?  @default("us")
+  createdAt              DateTime
+  gender                 String   @default("x")
+  id                     Int      @default(autoincrement())
+  name                   String
+  nickname               String
+  notificationEmails     Int      @default(1)
+  password               String?
+  preferredLanguage      String   @default("en-us")
+  prefersColorSchemeDark Boolean      @default(false)
+  prefersReducedMotion   Boolean      @default(false)
+  primaryEmail           Int?
+  profilePicture         String
+  role                   Int      @default(1)
+  timezone               String   @default("Europe/Amsterdam")
+  twoFactorEnabled       Boolean      @default(false)
+  twoFactorSecret        String?
+  updatedAt              DateTime @default(dbgenerated())
+  username               String
+
+  @@id([id, username])
+}
+
+model webhooks {
+  contentType    String
+  createdAt      DateTime
+  event          String
+  id             Int       @default(autoincrement()) @id
+  isActive       Boolean       @default(false)
+  lastFiredAt    DateTime?
+  organization   organizations    @relation(fields: [organizationId], references: [id])
+  organizationId Int
+  secret         String?
+  updatedAt      DateTime  @default(dbgenerated())
+  url            String
+}
```


